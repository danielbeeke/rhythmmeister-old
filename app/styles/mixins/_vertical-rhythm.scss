@mixin vertical-rhythm($padding-top: 0, $padding-bottom: 0, $margin-top: 0, $margin-bottom: 0, $size-name: '') {
  @if ($size-name != '') {
    $relative-line-height: $line-height;

    $font-size: map-get($font-sizes, $size-name);
    $cap-height: map-get($cap-heights, $size-name);

    $rows: $relative-line-height * $font-size / $baseline;

    $new-line-height-percentage-of-old: ceil($rows) * $baseline / (($relative-line-height * $font-size) / 100);
    $new-relative-line-height: $line-height * $new-line-height-percentage-of-old / 100;
    $relative-line-height: $new-relative-line-height;

    $box-height: $font-size * $relative-line-height;

    $cap-height-in-pixels: $box-height * $cap-height;

    @if ($cap-height-in-pixels > (floor($rows) * $baseline)) {
      $offset: (ceil($rows) * $baseline) - $cap-height-in-pixels;
      $box-height-with-top: $box-height + $offset;
      padding-top: $offset + ($padding-top * $baseline);
      padding-bottom: (ceil($rows + 1) * $baseline - $box-height-with-top) + ($padding-bottom * $baseline);
    }
    @else {
      $offset: (floor($rows) * $baseline) - $cap-height-in-pixels;
      $box-height-with-top: $box-height + $offset;
      padding-top: $offset + ($padding-top * $baseline);
      padding-bottom: (ceil($box-height-with-top / $baseline) * $baseline - $box-height-with-top) + ($padding-bottom * $baseline);
    }

    line-height: ceil($rows) * $baseline;
    font-size: $font-size;
  }
  @else {
    @if ($padding-top > 0) {
      padding-top: $padding-top * $baseline;
    }
    @if ($padding-bottom > 0) {
      padding-bottom: $padding-bottom * $baseline;
    }
  }

  @if ($margin-top > 0) {
    margin-top: $margin-top * $baseline;
  }
  @if ($margin-bottom > 0) {
    margin-bottom: $margin-bottom * $baseline;
  }
}