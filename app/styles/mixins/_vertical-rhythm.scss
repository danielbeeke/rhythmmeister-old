@mixin vertical-rhythm($top, $bottom, $size-name: '') {
  @if ($size-name) {
    $relative-line-height: $line-height;

    $font-size: map-get($font-sizes, $size-name);
    $cap-height: map-get($cap-heights, $size-name);

    $rows: $relative-line-height * $font-size / $baseline;

    $new-line-height-percentage-of-old: ceil($rows) * $baseline / (($relative-line-height * $font-size) / 100);
    $new-relative-line-height: $line-height * $new-line-height-percentage-of-old / 100;
    $relative-line-height: $new-relative-line-height;

    $box-height: $font-size * $relative-line-height;

    // User entered cap height is mixed with the line height
    $cap-height-in-pixels: $box-height * $cap-height;


    @if ($cap-height-in-pixels > (floor($rows) * $baseline)) {
      $offset: (ceil($rows) * $baseline) - $cap-height-in-pixels;
      $box-height-with-top: $box-height + $offset;
      padding-top: $offset + ($top * $baseline);
      padding-bottom: (ceil($rows + 1) * $baseline - $box-height-with-top) + ($bottom * $baseline);
    }
    @else {
      $offset: (floor($rows) * $baseline) - $cap-height-in-pixels;
      $box-height-with-top: $box-height + $offset;
      padding-top: $offset + ($top * $baseline);
      padding-bottom: (ceil($box-height-with-top / $baseline) * $baseline - $box-height-with-top) + ($bottom * $baseline);
    }

    line-height: ceil($rows) * $baseline;
    font-size: $font-size;
  }
  @else {
    @if ($top) {
      padding-top: $top * $baseline;
    }
    @if ($bottom) {
      padding-bottom: $bottom * $baseline;
    }
  }
}